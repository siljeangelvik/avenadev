<!doctype html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport"
          content="width=device-width, user-scalable=no, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Document</title>
</head>
<body>

<section class="mobileHidden">
    <fieldset>
        <legend>Roles:</legend>
        <label for="all"><input type="radio" value="all" name="role" id="all" checked>Alle</label>
        <label for="student"><input type="radio" value="student" name="role" id="student">Student</label>
        <label for="ansatt"><input type="radio" value="ansatt" name="role" id="ansatt">Ansatt</label>
        <label for="styret"><input type="radio" value="styret" name="role" id="styret">Styret</label>
    </fieldset>

    <fieldset>
        <legend>Months:</legend>
        <label for="januar"><input type="checkbox" value="januar" name="month" id="januar">Januar</label>
        <label for="februar"><input type="checkbox" value="februar" name="month" id="februar">Februar</label>
        <label for="mars"><input type="checkbox" value="mars" name="month" id="mars">Mars</label>
        <label for="april"><input type="checkbox" value="april" name="month" id="april">April</label>
        <label for="mai"><input type="checkbox" value="mai" name="month" id="mai">Mai</label>
        <label for="juni"><input type="checkbox" value="juni" name="month" id="juni">Juni</label>
        <label for="juli"><input type="checkbox" value="juli" name="month" id="juli">Juli</label>
        <label for="august"><input type="checkbox" value="august" name="month" id="august">August</label>
        <label for="september"><input type="checkbox" value="september" name="month" id="september">September</label>
        <label for="oktober"><input type="checkbox" value="oktober" name="month" id="oktober">Oktober</label>
        <label for="november"><input type="checkbox" value="november" name="month" id="november">November</label>
        <label for="desember"><input type="checkbox" value="desember" name="month" id="desember">Desember</label>
    </fieldset>
</section>

<ul id="out"></ul>

<script>

  const items = [
  {month:"Jan", roles:"student, ansatt, styret"},
  {month:"Feb", roles:"student, ansatt, styret"},
  {month:"Mar", roles:"student, ansatt, styret"},
  {month:"Apr", roles:"student, ansatt, styret"},
  {month:"Mai", roles:"student, ansatt, styret"},
  {month:"Jun", roles:"student, ansatt, styret"},
  {month:"Aug", roles:"student, ansatt, styret"},
  {month:"Sep", roles:"student, ansatt, styret"},
  {month:"Okt", roles:"student, ansatt, styret"},
  {month:"Nov", roles:"student, ansatt, styret"},
  {month:"Des", roles:"student, ansatt, styret"},
];



  const url = 'https://www.avena.dev/cms/wp-json/wp/v2/tribe_events';

  fetch(url)
      .then(response => response.json())
      .then(parsedData => {
          listData(parsedData.data);
      })
      .catch((error) => out.innerHTML = "Something's wrong!" + error)
      .finally(() => document.querySelector(".loader").remove());



  const out = document.querySelector("#eventsList")

  function listData(events) {
      events.forEach((event) => {
          let newOut =
              `<div class="displayDate">
                <a href="post.html?id=${id}">
                   <span id="outputMonths">${event.date}</span>
                </a>
            </div>
            <div>
                <h2><a href="post.html?id=${id}">${event.title.rendered}</a></h2>
                <p>${event.excerpt.rendered}</p></a>
            </div>
           </div>`;
          out.innerHTML += newOut;
      })
  }









      let listItems = (list) => {
        out.innerHTML = "";
        for (item of list) {
            let role = item.roles.split(","); // make array from string
            console.log(role);
            //let cOut = (item.length) === 1?colour[0]:"multicoloured";
            let cOut = (role.length) === 1?role[0]:role.join(" and ");
            out.innerHTML += `<li>${item.month} is a ${cOut} ${item.roles}</li>`;
        }
    }

    listItems(items);

    let radioButtons = document.querySelectorAll("input[name='item']");
    let all = document.querySelector("input#all");
    let student = document.querySelector("input#student");
    let ansatt = document.querySelector("input#ansatt");
    let styret = document.querySelector("input#styret");

    let filterMe = () => {
        //console.log("Let's filter!");
        let filteredList = [];

        // Filter based on animals
        // Find which radiobutton is checked
        let itemsChosen; // Clear any previous choices
        for (let btn of radioButtons) {
            if (btn.checked) itemsChosen = btn.value;
        }
        //console.log (animalChosen);
        if (itemsChosen === "all") {
            filteredList = items.slice(); // Make a copy to "protect" the original list
        } else {
            // Filter ot those animals with type equal to the type chosen
            filteredList = items.filter((item)=>item.roles === itemsChosen);
        }

        // THEN: Filter based on colour (based on the checkboxes)
        let filterMonths = []; // list of colours to look for, start fresh each time
        if (student.checked) filterMonths.push("months");
        if (ansatt.checked) filterMonths.push("month");
        if (styret.checked) filterMonths.push("month");
        if (itemsChosen.checked) filterMonths.push("apr");
        if (itemsChosen.checked) filterMonths.push("mai");
        if (itemsChosen.checked) filterMonths.push("jun");
        if (itemsChosen.checked) filterMonths.push("jul");
        if (itemsChosen.checked) filterMonths.push("aug");
        if (itemsChosen.checked) filterMonths.push("sep");
        if (itemsChosen.checked) filterMonths.push("okt");
        if (itemsChosen.checked) filterMonths.push("nov");
        if (itemsChosen.checked) filterMonths.push("des");

        //console.log (filterColours);

        if (filterMonths.length !== 0) { // If none is chosen, all is selected!
            // Run through the list now (filteredList)
            // and get the (list of) colour(s) of the animal,
            // and compare that to the colours in the filterColours list
            // and only return true it it's a match.
            filteredList = filteredList.filter((items)=>{
                let filterMonths = items.month.split(","); // make array from string
                console.log(`Let's check ${items.roles} with ${filterMonths}`);
                for (c of filterMonths) {
                    console.log (`Check if ${c} is in ${filterMonths}`)
                    if (filterMonths.includes(c)) return true;
                }
                return false;
            });
        }

        // After all filtering, list the filtered list
        listItems(filteredList);
    }

    // Set eventlistener for all Radiobuttons in the animalRadioButtons nodelist
    for (let r of radioButtons) r.addEventListener("change", filterMe);
    // Set eventlistener for all CheckBoxes found on the page
    for (let c of document.querySelectorAll("input[type='checkbox']")) c.addEventListener("change", filterMe);

</script>
</body>
</html>